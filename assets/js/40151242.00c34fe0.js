"use strict";(self.webpackChunkverse_developer=self.webpackChunkverse_developer||[]).push([[972],{3905:function(e,n,t){t.d(n,{Zo:function(){return d},kt:function(){return h}});var a=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var p=a.createContext({}),l=function(e){var n=a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},d=function(e){var n=l(e.components);return a.createElement(p.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},c=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,o=e.originalType,p=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),c=l(t),h=i,u=c["".concat(p,".").concat(h)]||c[h]||m[h]||o;return t?a.createElement(u,r(r({ref:n},d),{},{components:t})):a.createElement(u,r({ref:n},d))}));function h(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var o=t.length,r=new Array(o);r[0]=c;var s={};for(var p in n)hasOwnProperty.call(n,p)&&(s[p]=n[p]);s.originalType=e,s.mdxType="string"==typeof e?e:i,r[1]=s;for(var l=2;l<o;l++)r[l]=t[l];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}c.displayName="MDXCreateElement"},8471:function(e,n,t){t.r(n),t.d(n,{assets:function(){return d},contentTitle:function(){return p},default:function(){return h},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return m}});var a=t(7462),i=t(3366),o=(t(7294),t(3905)),r=["components"],s={id:"extension-data-api",title:"Extension Data API"},p=void 0,l={unversionedId:"extension-data-api",id:"extension-data-api",title:"Extension Data API",description:"Adding extensions that use the Verse Data API can make Verse less secure. Follow the Secure Deployment Practices guidelines before deploying your application to mitigate any vulnerabilities that may have been introduced.",source:"@site/docs/extension-data-api.md",sourceDirName:".",slug:"/extension-data-api",permalink:"/Verse-Extension-Documentation/docs/extension-data-api",tags:[],version:"current",frontMatter:{id:"extension-data-api",title:"Extension Data API"},sidebar:"docs",previous:{title:"Extension Points",permalink:"/Verse-Extension-Documentation/docs/extension-points"},next:{title:"Loading an Application for Development",permalink:"/Verse-Extension-Documentation/docs/development"}},d={},m=[{value:"Overview",id:"overview",level:2},{value:"Passing Data in a URL",id:"passing-data-in-a-url",level:2},{value:"Passing Data w/Cross-Document Messaging",id:"passing-data-wcross-document-messaging",level:2},{value:"The Handshake",id:"the-handshake",level:3},{value:"Parsing the Data",id:"parsing-the-data",level:3},{value:"Context Data Objects",id:"context-data-objects",level:2},{value:"Mail Compose",id:"mail-compose",level:3},{value:"Example Mail Compose Data",id:"example-mail-compose-data",level:4},{value:"Mail Read",id:"mail-read",level:3},{value:"Example Mail Read Data",id:"example-mail-read-data",level:4},{value:"Person",id:"person",level:3},{value:"Example Person Data",id:"example-person-data",level:4}],c={toc:m};function h(e){var n=e.components,t=(0,i.Z)(e,r);return(0,o.kt)("wrapper",(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Adding extensions that use the Verse Data API can make Verse less secure. Follow the ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"../best-security-practices"},"Secure Deployment Practices"))," guidelines before deploying your application to mitigate any vulnerabilities that may have been introduced."))),(0,o.kt)("h2",{id:"overview"},"Overview"),(0,o.kt)("p",null,"The Verse Data API is what enables your external application to communicate with Verse. There are two ways Verse is able to send data to your application:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"passing data as a URL query string parameter"),(0,o.kt)("li",{parentName:"ol"},"using what\u2019s known as a ",(0,o.kt)("inlineCode",{parentName:"li"},"context object"),", it is passed in the message event object of the ",(0,o.kt)("inlineCode",{parentName:"li"},"window.postMessage")," function")),(0,o.kt)("h2",{id:"passing-data-in-a-url"},"Passing Data in a URL"),(0,o.kt)("p",null,"Your application can receive data from Verse through URL query string parameters, which are added to the URL specified in the extension. There are two ways to format the URL query string so that it will be replaced with the desired data:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"${propertyName.property}")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"<propertyName.property>"))),(0,o.kt)("p",null,"For example, to send the name of a user from a business card extension to your application, specify the following URL in your extension:  "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'// ${propertyName.property} format\n"https://<your-domain-here>/extension.html?username=${profile.name}"\n\n// <propertyName.property> format\n"https://<your-domain-here>/extension.html?username=<profile.name>"\n')),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"profile.name")," property is a variable that contains the user\u2019s name. The valid data parameters are described in the ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"#context-data-objects"},"Context Objects"))," section. "),(0,o.kt)("p",null,"Your application is responsible for retrieving the URL query parameter with the desired data."),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"https://www.sitepoint.com/get-url-parameters-with-javascript/"},"Getting URL Parameters with JavaScript"))))),(0,o.kt)("h2",{id:"passing-data-wcross-document-messaging"},"Passing Data w/Cross-Document Messaging"),(0,o.kt)("p",null,"You can also use cross-document messaging instead to communicate with Verse. To handle messages from Verse, your web application needs to register an event listener by using:  "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'window.addEventListener("message", function(event) {\n  // handle message event code\n});\n')),(0,o.kt)("h3",{id:"the-handshake"},"The Handshake"),(0,o.kt)("p",null,"The data flow begins with a ",(0,o.kt)("inlineCode",{parentName:"p"},"handshake")," interaction between your application and Verse. In your application code, you must send a ",(0,o.kt)("inlineCode",{parentName:"p"},"com.ibm.verse.application.loaded")," message back to the Verse window to inform Verse that your web application is ready to receive data:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"window.addEventListener('message', function(evt) {\n  var verseApiType = evt && evt.data && evt.data.verseApiType;\n  if (verseApiType === 'com.ibm.verse.ping.application.loaded') {\n    evt.source.postMessage({\n      verseApiType: 'com.ibm.verse.application.loaded'\n    }, evt.origin);\n  }\n}, false);\n")),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Extensions that use cross-document messaging must add the ",(0,o.kt)("inlineCode",{parentName:"p"},"features")," property with the value ",(0,o.kt)("inlineCode",{parentName:"p"},'["core"]')," to enable communication with Verse. Take a look at an example ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"../extension-points#widget"},"widget extension"))," with this feature."))),(0,o.kt)("h3",{id:"parsing-the-data"},"Parsing the Data"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"message")," event received by your application contains a ",(0,o.kt)("inlineCode",{parentName:"p"},"data")," object, which has an object called ",(0,o.kt)("inlineCode",{parentName:"p"},"verseApiData"),"."),(0,o.kt)("p",null,"If the event is triggered by a widget with multiple actions, you should verify the ",(0,o.kt)("inlineCode",{parentName:"p"},"actionId")," property of the ",(0,o.kt)("inlineCode",{parentName:"p"},"verseApiData")," object matches the expected, unique, action ",(0,o.kt)("inlineCode",{parentName:"p"},"id")," to ensure that you only run your code for the correct message events."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'window.addEventListener("message", function(event) {\n  if (event.data.verseApiData.actionId === "unique.action.id") {\n    var verseData = event.data.verseApiData.context; // The context data\n  }\n}\n')),(0,o.kt)("p",null,"The information that you need from Verse is stored in the ",(0,o.kt)("inlineCode",{parentName:"p"},"context")," property which contains different data depending on where, in the Verse UI, it is called from."),(0,o.kt)("h2",{id:"context-data-objects"},"Context Data Objects"),(0,o.kt)("p",null,"The information contained in the context object depends on the where the action is called. For example, adding a ",(0,o.kt)("inlineCode",{parentName:"p"},"mail.read")," action extension sends information relating to the selected mail: ",(0,o.kt)("inlineCode",{parentName:"p"},"title"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"subject"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"body"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"etc"),". Whereas, adding a ",(0,o.kt)("inlineCode",{parentName:"p"},"com.ibm.appreg.object.person")," action extension sends the person\u2019s ",(0,o.kt)("inlineCode",{parentName:"p"},"name"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"email"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"phone"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"etc."),"."),(0,o.kt)("p",null,"There are three context objects: ",(0,o.kt)("inlineCode",{parentName:"p"},"Mail Compose"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"Mail Read"),", and ",(0,o.kt)("inlineCode",{parentName:"p"},"Person"),"."),(0,o.kt)("h3",{id:"mail-compose"},"Mail Compose"),(0,o.kt)("p",null,"A context object with mail compose data is passed to actions placed in the Mail Compose view (",(0,o.kt)("inlineCode",{parentName:"p"},"mail.compose"),")."),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Note that ",(0,o.kt)("inlineCode",{parentName:"p"},"recipientBcc")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"attachments")," properties are only available when they are enabled in permissions property of a ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"../extension-points#widget-actions"},"Widget Action"))," or ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"../extension-points#beforeonsend"},"BeforeOnSend"))," definition."))),(0,o.kt)("h4",{id:"example-mail-compose-data"},"Example Mail Compose Data"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "attachments": [\n    {\n      "assignedName": "",\n      "name": "",\n      "size": "",\n      "selected": "",\n      "uploaded": "",\n    }\n  ],\n  "body": "",\n  "contextId": "",\n  "id": "",\n  "recipientBcc": [\n    {\n      "displayName": "",\n      "emailAddress": ""\n    }\n  ],\n  "recipientCC": [\n    {\n      "displayName": "",\n      "emailAddress": ""\n    }\n  ],\n  "recipientTo": [\n    {\n      "displayName": "",\n      "emailAddress": ""\n    }\n  ],\n  "subject": ""\n}\n')),(0,o.kt)("h3",{id:"mail-read"},"Mail Read"),(0,o.kt)("p",null,"A context object with mail read data is passed to actions placed in the Mail Read view (",(0,o.kt)("inlineCode",{parentName:"p"},"mail.read"),")."),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Note that ",(0,o.kt)("inlineCode",{parentName:"p"},"recipientBcc")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"attachments")," properties are only available when they are enabled in permissions property of a ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"../extension-points#widget-actions"},"Widget Action"))," definition."))),(0,o.kt)("h4",{id:"example-mail-read-data"},"Example Mail Read Data"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "attachments": [\n    {\n      "assignedName": "",\n      "name": "",\n      "size": "",\n      "selected": "",\n      "uploaded": "",\n    }\n  ],\n  "body": "",\n  "contextId": "",\n  "id": "",\n  "isPreventCopy": "",\n  "recipientBcc": [\n    {\n      "displayName": "",\n      "emailAddress": ""\n    }\n  ],\n  "recipientCC": [\n    {\n      "displayName": "",\n      "emailAddress": ""\n    }\n  ],\n  "recipientTo": [\n    {\n      "displayName": "",\n      "emailAddress": ""\n    }\n  ],\n  "sender": {\n    "displayName": "",\n    "emailAddress": ""\n  },\n  "subject": "",\n  "timeSent": ""\n}\n')),(0,o.kt)("h3",{id:"person"},"Person"),(0,o.kt)("p",null,"A context object with person data is passed to actions placed on the back of the person business cards (",(0,o.kt)("inlineCode",{parentName:"p"},"com.ibm.appreg.object.person"),")."),(0,o.kt)("h4",{id:"example-person-data"},"Example Person Data"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "currentUser": {\n    "company": "",\n    "displayName": "",\n    "fax": "",\n    "id": "",\n    "jobTitle": "",\n    "mobilePhone": "",\n    "name": {\n      "displayName": "",\n      "displayType": "",\n      "familyName": "",\n      "formatted": "",\n      "givenName": "",\n      "honorificPrefix": "",\n      "honorificSuffix": "",\n      "middleName": ""\n    },\n    "network": "",\n    "photo": "",\n    "photoUrl": "",\n    "primaryAddress": "",\n    "primaryEmail": "",\n    "primaryPhone": "",\n    "status": "",\n    "tags": "",\n    "website": ""\n  },\n  "profile": {\n    "company": "",\n    "displayName": "",\n    "fax": "",\n    "id": "",\n    "jobTitle": "",\n    "mobilePhone": "",\n    "name": {\n      "displayName": "",\n      "displaytype": "",\n      "familyName": "",\n      "formatted": "",\n      "givenName": "",\n      "honorificPrefix": "",\n      "honorificSuffix": "",\n      "middleName": ""\n    },\n    "network": "",\n    "orgId": "",\n    "photo": "",\n    "photoUrl": "",\n    "primaryAddress": "",\n    "primaryEmail": "",\n    "primaryPhone": "",\n    "status": "",\n    "tags": "",\n    "website": ""\n  }\n}\n')))}h.isMDXComponent=!0}}]);